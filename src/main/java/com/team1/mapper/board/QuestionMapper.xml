<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="com.team1.mapper.board.QuestionMapper">


	<select id="getCountRows" resultType="int">
		SELECT COUNT(*) FROM tb_board_question q
		<where>
			<if test="query != null">
				AND q.content like concat('%',#{query},'%' )
			</if>

			<if test="location != null">
				AND q.location = #{location}
			</if>

			<if test="tag != null">
				AND q.tag = #{tag}
			</if>
		</where>
	</select>

	<select id="getList"
		resultType="com.team1.domain.board.QuestionVO">
		SELECT
		q.id,
		u.id,
		u.nickname,
		q.memberId,
		q.tag,
		q.content,
		q.location,
		q.title,
		q.inserted,
		q.updated
		FROM
		tb_user u
		JOIN
		tb_board_question q
		ON
		u.id = q.memberId

		ORDER BY id DESC
	</select>

	<select id="getListPage"
		resultType="com.team1.domain.board.QuestionVO">
		SELECT
		q.id,
		u.id,
		u.nickname,
		q.memberId,
		q.tag,
		q.content,
		q.location,
		q.title,
		q.inserted,
		q.updated
		FROM
		tb_user u
		JOIN
		tb_board_question q
		ON
		u.id = q.memberId

		<where>
			<if test="query != null">
				AND q.content like concat('%',#{query},'%' )
			</if>

			<if test="location != null">
				AND q.location = #{location}
			</if>

			<if test="tag != null">
				AND q.tag = #{tag}
			</if>
		</where>

		GROUP BY q.id
		ORDER BY q.id DESC
		LIMIT #{from}, #{items}
	</select>

	<insert id="insert">
		INSERT INTO
		tb_board_question (memberId, location,
		tag, title, content)
		VALUES
		(#{memberId}, #{location},
		#{tag}, #{title},
		#{content})
	</insert>


	<select id="read" resultType="com.team1.domain.board.QuestionVO">
		SELECT

		q.id,
		q.title,
		q.content,
		q.tag,
		q.inserted,
		q.location,
		q.updated,
		u.nickname,
		u.id
		FROM
		tb_board_question q
		JOIN
		tb_user u ON q.memberId = u.id
		WHERE

		q.id = #{id}
	</select>

</mapper>